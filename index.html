<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
   
    	  <script src="assets/dataViz/d3.v3.min.js"></script>
	  <script src="assets/dataViz/d3.v3.min.js"></script>
    <style type="text/css">
  
.chart {
  display: block;
  margin: auto;
  margin-top: 40px;
}	
	
body { text-align: left; }
p.source { font-style: italic; }
a { color: blue; }

svg {
  display: block;
  margin: auto;
}

text {
  font-size: 8px;
}

rect {
  fill: none;
  stroke: #fff;
}


    </style>
  </head>
  <body>
   
    <div id="body">

CSV Filter 1 - This will filter by "sec" : <select id="sec">
		  <option value="A" >A</option>
          </select> <br>
<font color="red">
</div>
	</div>
    
    <script type="text/javascript">
	
var w = 400,
    h = 200,
	color = d3.scale.category20b(),
    root, 
    node, 
	data;
	
var treemap = d3.layout.treemap()
	.round(false)
    .size([w, h])
    .sticky(true)
    .children(function(d) { return d.values; }) 
    .value(function(d) { return d.key; }); 
	

var svg = d3.select("#body").append("div")
    .attr("class", "chart")
    .style("width", w + "px")
    .style("height", h + "px")
    .append("svg:svg")
    .attr("width", w)
    .attr("height", h)
    .append("svg:g")
    .attr("transform", "translate(.5,.5)");
		
	//load csv and copy to global variable
d3.csv("assets/dataViz/group_a_sk.csv", function(error, data) {
daten = data
  graph = {"nodes" : [], "links" : []};
/*datanest();  
datadraw(); */ 
datafilter();//filter csv 
datanest(); //nest filtered csv 
datadraw(); //render nested and filtered csv 
});

function datafilter(d){
var group = document.getElementById("sec");
var sec = group.options[group.selectedIndex].value;
data = data.filter(function(d) { return d.sec  == sec;});
return data;}

function datanest(d){
 node = root = {values: d3.nest()
      .key(function(d) { return d.sec; })
      .rollup(function(d) {
        return d.map(function(d) {
          return {key: d.bud};
        });
      })
      .entries(data)};
	  return node;
	  return root;
	}

function datadraw(d){
  var nodes = treemap.nodes(root)
      .filter(function(d) { return !d.values; }); 

  var cell = svg.selectAll("g")
      .data(nodes)
    .enter().append("svg:g")
      .attr("class", "cell")
      .attr("transform", function(d) { return "translate(" + d.x + "," + d.y + ")"; });
     
  cell.append("svg:rect")
      .attr("width", function(d) { return d.dx - 1; })
      .attr("height", function(d) { return d.dy - 1; })
      .style("fill", function(d) { return color(d.parent.key); }); 

  cell.append("svg:text")
      .attr("x", function(d) { return d.dx / 2; })
      .attr("y", function(d) { return d.dy / 2; })
      .attr("dy", ".35em")
      .attr("text-anchor", "middle")
      .text(function(d) { return d.key; }) 
      .style("opacity", function(d) { d.w = this.getComputedTextLength(); return d.dx > d.w ? 1 : 0; });
	   
	 }; 
	 
    </script>
  </body>
</html>
